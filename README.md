**Описание API для управления информацией о фильмах и режиссерах**

**Описание**

Функциональность "Вывод фильмов режиссёра" позволяет пользователям получить список фильмов, созданных определенным режиссером, отсортированных по количеству лайков или году выпуска. Для удобства пользователей информация о фильмах теперь содержит имя режиссёра.

**API для вывода фильмов режиссёра**

1. **Вывод всех фильмов режиссёра, отсортированных по количеству лайков или году выпуска**
   - **Метод:** GET
   - **Endpoint:** /films/director/{directorId}
   - **Параметры запроса:** sortBy=[year,likes]
   - **Описание:** Возвращает список фильмов определенного режиссёра, отсортированных по количеству лайков или году выпуска.

**Пример использования API:**

- Получить список фильмов режиссёра с ID 1, отсортированных по количеству лайков: GET /films/director/1?sortBy=likes
- Получить список фильмов режиссёра с ID 1, отсортированных по году выпуска: GET /films/director/1?sortBy=year

**Описание других API эндпоинтов**

1. **Получение списка всех режиссёров**
   - **Метод:** GET
   - **Endpoint:** /directors
   - **Описание:** Возвращает список всех режиссёров.
1. **Получение информации о режиссёре по ID**
   - **Метод:** GET
   - **Endpoint:** /directors/{id}
   - **Описание:** Получение информации о конкретном режиссёре по его ID.
1. **Создание нового режиссёра**
   - **Метод:** POST
   - **Endpoint:** /directors
   - **Описание:** Позволяет добавить нового режиссёра.
1. **Изменение информации о режиссёре**
   - **Метод:** PUT
   - **Endpoint:** /directors
   - **Описание:** Изменяет информацию о режиссёре.
1. **Удаление режиссёра**
   - **Метод:** DELETE
   - **Endpoint:** /directors/{id}
   - **Описание:** Удаляет информацию о режиссёре по его ID.

**Пример использования API:**

- Получить список всех режиссёров: GET /directors
- Получить информацию о режиссёре с ID 1: GET /directors/1
- Создать нового режиссёра: POST /directors
- Изменить информацию о режиссёре: PUT /directors
- Удалить режиссёра с ID 2: DELETE /directors/2

В результате этих действий пользователи смогут удобно просматривать фильмы по режиссёрам и узнавать больше о создателях любимых кинолент.

**Описание ресурсов**

- **films:** содержит информацию о фильмах, включая название, дату выпуска, описание, длительность, рейтинг MPA, жанры и режиссёра.
- **directors:** содержит информацию о режиссёрах, включая их имя.



1. **Удаление пользователя и фильма по идентификатору**

**Описание**

Функциональность "Удаление пользователя и фильма" позволяет администраторам или пользователям удалить учетную запись пользователя или фильм по их уникальному идентификатору.

**API для удаления пользователя и фильма**

1. **Удаление пользователя по идентификатору**
   - **Метод:** DELETE
   - **Endpoint:** /users/{userId}
   - **Описание:** Удаляет пользователя с указанным идентификатором из базы данных.
1. **Удаление фильма по идентификатору**
   - **Метод:** DELETE
   - **Endpoint:** /films/{filmId}
   - **Описание:** Удаляет информацию о фильме по указанному идентификатору из базы данных.

**Пример использования API:**

- Удалить пользователя с идентификатором 3: DELETE /users/3
- Удалить фильм с идентификатором 10: DELETE /films/10

Эти эндпоинты позволят пользователям и администраторам удалять учетные записи пользователей и информацию о фильмах по заданным идентификаторам, что обеспечивает удобство в управлении данными в системе.


1. **Вывод топ-N фильмов по количеству лайков с фильтрацией**

**Описание**

Функциональность "Топ-N фильмов по количеству лайков" позволяет пользователям получить список самых популярных фильмов определенного жанра за заданный год, отсортированных по количеству лайков.

**API для вывода топ-N фильмов по количеству лайков**

1. **Получение списка самых популярных фильмов по жанру и году**
   - **Метод:** GET
   - **Endpoint:** /films/popular
   - **Параметры запроса:** count={limit}&genreId={genreId}&year={year}
   - **Описание:** Возвращает список топ-N самых популярных фильмов определенного жанра за указанный год.

**Пример использования API:**

- Получить список топ-5 самых популярных фильмов жанра с ID 1 за 2022 год: GET /films/popular?count=5&genreId=1&year=2022
- Получить список топ-10 самых популярных фильмов жанра с ID 2 за 2021 год: GET /films/popular?count=10&genreId=2&year=2021

Эта функциональность позволяет пользователям узнать самые любимые фильмы определенного жанра за определенный год, что обогатит их кинематографический опыт.


1. **Вывод общих фильмов с другом по популярности**

**Описание**

Функциональность "Общие фильмы с другом по популярности" позволяет пользователям получить список фильмов, которые есть как у текущего пользователя, так и у другого пользователя (друга), отсортированных по их популярности.

**API для вывода общих фильмов с другом**

1. **Получение списка общих фильмов с другом**
   - **Метод:** GET
   - **Endpoint:** /films/common
   - **Параметры запроса:** userId={userId}&friendId={friendId}
   - **Описание:** Возвращает список фильмов, которые присутствуют и у текущего пользователя, и у другого пользователя (друга), отсортированных по популярности.

**Пример использования API:**

- Получить список общих фильмов с пользователем с ID 1 и пользователем с ID 2: GET /films/common?userId=1&friendId=2
- Результат будет содержать фильмы, которые есть как у первого пользователя, так и у второго, отсортированные по популярности.

Эта функциональность позволяет пользователям увидеть общие предпочтения в выборе фильмов с их друзьями и получить рекомендации на основе популярности этих фильмов.

**Описание параметров**

- **userId:** Идентификатор пользователя, который запрашивает информацию об общих фильмах.
- **friendId:** Идентификатор другого пользователя, с которым сравнивается список фильмов.

**Пример использования API:**

1. Получить список общих фильмов между пользователем с ID 3 и пользователем с ID 5:

GET /films/common?userId=3&friendId=5

2. Вывести список общих фильмов между пользователем с ID 8 и пользователем с ID 10:

GET /films/common?userId=8&friendId=10






1. **Поиск фильмов по названию и режиссёру**
### **Описание**
Функциональность "Поиск фильмов по названию и режиссёру" позволяет пользователям искать фильмы по ключевым словам в названии и именам режиссёров. Алгоритм поиска умеет работать с подстроками, что позволяет удобно находить фильмы даже при частичном совпадении.
### **API для поиска фильмов**
1. **Получение списка фильмов по поисковому запросу, отсортированных по популярности**
   - **Метод:** GET
   - **Endpoint:** /films/search
   - **Параметры запроса:** query, by
   - **Описание:** Возвращает список фильмов, удовлетворяющих поисковому запросу (по подстроке) и критериям поиска (по режиссёру, по названию или одновременно и по режиссёру и по названию), отсортированных по популярности.

**Пример использования**

- Для поиска фильмов с ключевым словом "крад" по названию и режиссёру одновременно: GET /films/search?query=крад&by=director,title
- Результат будет содержать список фильмов, у которых в названии или у режиссёра есть подстрока "крад", отсортированных по популярности.

**Параметры запроса**

- **query:** Текст для поиска, может быть подстрокой.
- **by:** Указывает по каким параметрам искать фильмы, может принимать значения director (поиск по режиссёру), title (поиск по названию) или оба значения через запятую для одновременного поиска по режиссёру и по названию.

**Пример использования API:**

1. Найти фильмы с подстрокой "крад" в названии:

GET /films/search?query=крад&by=title

2. Искать фильмы с подстрокой "крад" в названии или у режиссёра:

GET /films/search?query=крад&by=director,title


1. **Рекомендации фильмов для просмотра**

**Описание**

Функциональность "Рекомендации фильмов для просмотра" основана на простой рекомендательной системе, которая находит пользователей с максимальным количеством пересечения по лайкам, определяет фильмы, которые один пользователь лайкнул, а другой нет, и рекомендует фильмы схожие с предпочтениями пользователя, которые ещё не оценили.

**API для получения рекомендаций фильмов**

1. **Получение рекомендаций фильмов для просмотра**
   - **Метод:** GET
   - **Endpoint:** /users/{id}/recommendations
   - **Описание:** Возвращает список рекомендуемых фильмов для просмотра на основе простой рекомендательной системы.

**Пример использования API:**

- Получить рекомендации по фильмам для просмотра для пользователя с ID 1: GET /users/1/recommendations

Эта функциональность поможет пользователям открывать для себя новые фильмы, соответствующие их вкусам и предпочтениям, благодаря анализу их лайков и рекомендациям на основе схожих пользователей.



1. **Отзывы на фильмы**

**Описание**

Функциональность "Отзывы на фильмы" позволяет пользователям оставлять отзывы к фильмам, оценивать их полезность, определять тип отзыва (негативный/положительный) и влиять на их рейтинг. Отзывы будут сортироваться по рейтингу полезности для лучшего отображения значимых отзывов.

**Характеристики отзыва**

- **Оценка:** "полезно" или "бесполезно".
- **Тип отзыва:** "негативный" или "положительный".
- **Рейтинг отзыва:** По умолчанию равен нулю. Пользователи могут оценить отзыв как полезный или бесполезный, увеличивая или уменьшая его рейтинг на 1 соответственно.

**API для работы с отзывами**

1. **Добавление нового отзыва**
   - **Метод:** POST
   - **Endpoint:** /reviews
   - **Описание:** Добавляет новый отзыв на фильм.
1. **Редактирование отзыва**
   - **Метод:** PUT
   - **Endpoint:** /reviews
   - **Описание:** Редактирует имеющийся отзыв.
1. **Удаление отзыва**
   - **Метод:** DELETE
   - **Endpoint:** /reviews/{id}
   - **Описание:** Удаляет указанный отзыв.
1. **Получение отзыва по идентификатору**
   - **Метод:** GET
   - **Endpoint:** /reviews/{id}
   - **Описание:** Возвращает отзыв по заданному идентификатору.
1. **Получение всех отзывов по идентификатору фильма**
   - **Метод:** GET
   - **Endpoint:** /reviews
   - **Параметры запроса:** filmId, count
   - **Описание:** Возвращает отзывы по определенному фильму или все отзывы если фильм не указан. Параметр count задает количество отзывов для вывода.
1. **Управление лайками и дизлайками отзыва**
   - **Установить лайк отзыву:** PUT /reviews/{id}/like/{userId}
   - **Установить дизлайк отзыву:** PUT /reviews/{id}/dislike/{userId}
   - **Удалить лайк отзыва:** DELETE /reviews/{id}/like/{userId}
   - **Удалить дизлайк отзыва:** DELETE /reviews/{id}/dislike/{userId}


**Примеры использования API:**

1. Добавить новый отзыв:

POST /reviews

2. Получить отзыв по идентификатору 15:

GET /reviews/15

3. Удалить отзыв с идентификатором 20:

DELETE /reviews/20

4. Получить все отзывы по фильму с ID 8:

GET /reviews?filmId=8&count=10

5. Поставить лайк отзыву с ID 25 от пользователя с ID 3:

PUT /reviews/25/like/3



1. **Лента событий пользователя**

**Описание**

Функциональность "Просмотр последних событий" позволяет пользователям получать информацию о последних событиях, происходящих на платформе, таких как добавление в друзья, удаление из друзей, лайки и отзывы, оставленные друзьями пользователя. Лента событий отображает активности пользователей и другие значимые события.** 

**Таблица для хранения информации о событиях пользователя**

Для хранения информации о действиях пользователя (лайки, добавление друзей, отзывы и т.д) создана таблица. Структура:

- **Id –** порядковый идентификатор записи
- **UserId** - идентификатор пользователя, для которого фиксируется действие
- **EventType** - одно из значениий (LIKE, REVIEW или FRIEND)
- **Operation -** одно из значениий (REMOVE, ADD, UPDATE)
- **EntityId** - идентификатор события
- **Timestamp** - время совершенного действия

**API для ленты событий пользователя**

1. **Получение ленты событий пользователя**
   - **Метод:** GET
   - **Endpoint:** /users/{id}/feed
   - **Описание:** Возвращает ленту событий (действий) пользователя, таких как добавление/удаление друзей, лайки, отзывы от друзей и т.д.

**Пример использования API:**

- Получить ленту событий для пользователя с ID 3: GET /users/3/feed

**Пример структуры и данных таблицы для хранения информации о событиях (в данном примере использован JOIN 2х таблиц справочников – EventType и Operation, т.к. в базовую таблицу <feed\_history> записываются их Id)**

|**Id**|**UserId**|**EventType**|**EntityId**|**Operation**|**Timestamp**|
| :-: | :-: | :-: | :-: | :-: | :-: |
|1|3|LIKE|5|ADD|2022-10-01 08:00:00|
|2|3|FRIEND|7|ADD|2022-10-02 10:30:00|
|3|3|REVIEW|4|ADD|2022-10-03 14:45:00|
|4|3|LIKE|6|REMOVE|2022-10-04 16:20:00|
|…|...|...|...|...|...|

